// InternetFriends Design System - Component Mixins
// Reusable SCSS mixins for common component patterns using @use

@use "sass:map";
@use "../tokens/colors.scss" as c;
@use "../tokens/spacing.scss" as s;
@use "../tokens/typography.scss" as t;
@use "./focus.scss" as f;

// Button component mixin
@mixin button-base() {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: s.spacing("sm");
  padding: s.spacing("md") s.spacing("lg");
  border: 1px solid transparent;
  border-radius: s.radius("md");
  font-size: t.font-size("sm");
  font-weight: t.font-weight("medium");
  line-height: t.line-height("tight");
  text-decoration: none;
  cursor: pointer;
  transition: all t.duration("fast") t.easing("ease-out");
  user-select: none;

  @include f.focus-interactive();

  &:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }
}

// Button variants
@mixin button-primary() {
  @include button-base();
  background: c.accent("primary");
  color: white;
  border-color: c.accent("primary");

  &:hover:not(:disabled) {
    background: c.$if-primary-hover;
    border-color: c.$if-primary-hover;
  }

  &:active:not(:disabled) {
    transform: translateY(1px);
  }
}

@mixin button-secondary() {
  @include button-base();
  background: transparent;
  color: c.color-light("text-primary");
  border-color: c.color-light("border-primary");

  &:hover:not(:disabled) {
    background: c.color-light("bg-secondary");
    border-color: c.color-light("border-secondary");
  }
}

@mixin button-ghost() {
  @include button-base();
  background: transparent;
  color: c.color-light("text-secondary");
  border: none;

  &:hover:not(:disabled) {
    background: c.color-light("bg-secondary");
    color: c.color-light("text-primary");
  }
}

// Glass morphism mixin
@mixin glass-morphism($bg: c.$glass-bg-header, $border: c.$glass-border) {
  background: $bg;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid $border;
  box-shadow: t.shadow("glass");
}

// Enhanced glass with better browser support
@mixin glass-enhanced(
  $bg: c.$glass-bg-overlay,
  $fallback: rgba(255, 255, 255, 0.9)
) {
  // Fallback for browsers without backdrop-filter support
  background: $fallback;

  @supports (backdrop-filter: blur(1px)) {
    background: $bg;
    backdrop-filter: blur(16px) saturate(180%);
    -webkit-backdrop-filter: blur(16px) saturate(180%);
  }

  border: 1px solid c.$glass-border-enhanced;
  box-shadow:
    t.shadow("glass"),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

// Card component mixin
@mixin card-base() {
  background: c.color-light("bg-primary");
  border: 1px solid c.color-light("border-primary");
  border-radius: s.radius("lg");
  box-shadow: t.shadow("sm");
  overflow: hidden;
  transition: box-shadow t.duration("fast") t.easing("ease-out");
}

@mixin card-interactive() {
  @include card-base();
  cursor: pointer;

  @include f.focus-container();

  &:hover {
    box-shadow: t.shadow("md");
    border-color: c.color-light("border-secondary");
  }
}

@mixin card-glass() {
  @include glass-morphism();
  border-radius: s.radius("lg");
  overflow: hidden;
}

// Input component mixin
@mixin input-base() {
  width: 100%;
  padding: s.spacing("md");
  border: 1px solid c.color-light("border-primary");
  border-radius: s.radius("sm");
  font-size: t.font-size("sm");
  line-height: t.line-height("normal");
  background: c.color-light("bg-primary");
  color: c.color-light("text-primary");
  transition: border-color t.duration("fast") t.easing("ease-out");

  @include f.focus-input();

  &::placeholder {
    color: c.color-light("text-tertiary");
  }

  &:disabled {
    background: c.color-light("bg-muted");
    cursor: not-allowed;
  }
}

// Loading spinner mixin
@mixin spinner($size: 20px, $color: c.accent("primary"), $thickness: 2px) {
  width: $size;
  height: $size;
  border: $thickness solid rgba($color, 0.2);
  border-top: $thickness solid $color;
  border-radius: 50%;
  animation: spin t.duration("slowest") linear infinite;

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
}

// Visually hidden (accessibility)
@mixin visually-hidden() {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

// Truncate text
@mixin truncate() {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

// Multi-line truncate
@mixin truncate-lines($lines: 2) {
  display: -webkit-box;
  -webkit-line-clamp: $lines;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

// Container with max-width and centering
@mixin container($max-width: s.container-size("xl")) {
  width: 100%;
  max-width: $max-width;
  margin: 0 auto;
  padding: 0 s.spacing("lg");
}

// Flex center utility
@mixin flex-center() {
  display: flex;
  align-items: center;
  justify-content: center;
}

// Grid auto-fit pattern
@mixin grid-auto-fit($min-width: 250px, $gap: s.spacing("lg")) {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax($min-width, 1fr));
  gap: $gap;
}

// Aspect ratio utility
@mixin aspect-ratio($ratio: "16/9") {
  aspect-ratio: #{$ratio};

  // Fallback for older browsers
  @supports not (aspect-ratio: 1 / 1) {
    position: relative;
    overflow: hidden;

    &::before {
      content: "";
      display: block;
      padding-bottom: calc(100% / (#{$ratio}));
    }

    > * {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }
}
